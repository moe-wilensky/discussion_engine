{% extends "base.html" %}
{% load static %}

{% block title %}Browse Discussions{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-gray-900">Discussions</h1>
        <a href="{% url 'discussion-create' %}" class="btn btn-primary">
            Create Discussion
        </a>
    </div>

    <!-- Search and Filter Bar -->
    <div class="bg-white shadow rounded-lg p-4 mb-6">
        <div class="flex flex-col md:flex-row gap-4">
            <!-- Search Bar -->
            <div class="flex-1">
                <label for="search" class="sr-only">Search discussions</label>
                <div class="relative">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <svg class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                    </div>
                    <input type="text" 
                           name="search" 
                           id="search"
                           value="{{ search_query|default:'' }}"
                           placeholder="Search discussions by topic or details..."
                           class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                           hx-get="{% url 'discussion-list' %}"
                           hx-trigger="keyup changed delay:500ms"
                           hx-target="#discussion-list"
                           hx-include="[name='filter']">
                </div>
            </div>
            
            <!-- Filter Dropdown -->
            <div class="flex gap-3">
                <select name="filter" 
                        id="filter"
                        class="block w-full md:w-48 px-3 py-2 border border-gray-300 rounded-md leading-5 bg-white focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                        hx-get="{% url 'discussion-list' %}"
                        hx-trigger="change"
                        hx-target="#discussion-list"
                        hx-include="[name='search']">
                    <option value="all" {% if filter == 'all' %}selected{% endif %}>All Discussions</option>
                    <option value="active" {% if filter == 'active' %}selected{% endif %}>Active Only</option>
                    <option value="archived" {% if filter == 'archived' %}selected{% endif %}>Archived</option>
                    <option value="mine" {% if filter == 'mine' %}selected{% endif %}>My Discussions</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Discussion List -->
    <div class="space-y-4" id="discussion-list">
        {% for discussion in discussions %}
            {% include "components/discussion_card.html" with discussion=discussion %}
        {% empty %}
            <div class="text-center py-12 bg-gray-50 rounded-lg">
                <p class="text-gray-500 text-lg">No discussions found.</p>
                <a href="{% url 'discussion-create' %}" class="mt-4 inline-block text-blue-600 hover:text-blue-800">
                    Create your first discussion &rarr;
                </a>
            </div>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if discussions.has_other_pages %}
    <div class="mt-8 flex justify-center">
        <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px">
            {% if discussions.has_previous %}
            <a href="?page={{ discussions.previous_page_number }}" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                Previous
            </a>
            {% endif %}
            
            <span class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700">
                Page {{ discussions.number }} of {{ discussions.paginator.num_pages }}
            </span>
            
            {% if discussions.has_next %}
            <a href="?page={{ discussions.next_page_number }}" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                Next
            </a>
            {% endif %}
        </nav>
    </div>
    {% endif %}
</div>
{% endblock %}
